<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko" data-layout="twocolumn" data-sidebar="light" data-sidebar-size="lg"
	data-sidebar-image="none" data-preloader="disable">

<head th:replace="~{fragments/administration/common :: autoAdminHead}">
</head>

<body class="twocolumn-panel">

	<div id="layout-wrapper">
		<header th:replace="~{fragments/administration/common :: autoAdminHeader}"></header>
		<div th:replace="~{fragments/administration/common :: autoAdminModal}"></div>
		<div th:replace="~{fragments/administration/common :: autoAdminSideMenu}"></div>
		<div class="vertical-overlay"></div>

		<div class="main-content">
			<div class="page-content">
				<div class="container-fluid">

					<!-- ✅ 추가 CSS (충돌 방지: product-detail-added- prefix만 사용) -->
					<style>
						/* =========================
						   Product Detail Added Styles
						   ========================= */

						/* 섹션 전체 감싸는 래퍼 */
						.product-detail-added-spec-wrap {
							width: 100%;
							margin-top: 8px;
						}

						/* 타이틀 영역 */
						.product-detail-added-spec-title {
							display: flex;
							align-items: center;
							justify-content: space-between;
							gap: 12px;
							margin-bottom: 12px;
						}

						.product-detail-added-spec-title h5 {
							margin: 0;
							font-weight: 700;
							letter-spacing: -0.2px;
						}

						/* "중요" 느낌의 배지 (선택) */
						.product-detail-added-spec-badge {
							font-size: 12px;
							font-weight: 600;
							padding: 6px 10px;
							border-radius: 999px;
							background: rgba(0, 0, 0, 0.06);
							color: #333;
							white-space: nowrap;
						}

						/* 옵션 카드 컨테이너 */
						.product-detail-added-spec-card {
							border: 1px solid rgba(0, 0, 0, 0.08);
							border-radius: 14px;
							background: #fff;
							padding: 14px;
						}

						/* 옵션 그리드(화면 넓게 사용) */
						.product-detail-added-spec-grid {
							display: grid;
							grid-template-columns: repeat(2, minmax(0, 1fr));
							gap: 10px;
						}

						/* 화면이 매우 넓으면 3열까지 */
						@media (min-width: 1400px) {
							.product-detail-added-spec-grid {
								grid-template-columns: repeat(3, minmax(0, 1fr));
							}
						}

						/* 태블릿/모바일은 1열 */
						@media (max-width: 991.98px) {
							.product-detail-added-spec-grid {
								grid-template-columns: 1fr;
							}
						}

						/* 각 옵션 아이템 (키/값 한 덩어리) */
						.product-detail-added-spec-item {
							border: 1px solid rgba(0, 0, 0, 0.08);
							border-radius: 12px;
							padding: 12px 12px;
							display: flex;
							gap: 12px;
							align-items: flex-start;
							min-height: 62px;
						}

						/* 왼쪽 키 */
						.product-detail-added-spec-key {
							flex: 0 0 120px;
							max-width: 120px;
							color: #6c757d;
							font-weight: 700;
							font-size: 14px;
							line-height: 1.2;
							letter-spacing: -0.1px;
							padding-top: 2px;
						}

						/* 오른쪽 값 */
						.product-detail-added-spec-val {
							flex: 1 1 auto;
							color: #111;
							font-weight: 800;
							font-size: 16px;
							line-height: 1.25;
							letter-spacing: -0.2px;

							/* 길어질 때 정리 */
							word-break: break-word;
							overflow-wrap: anywhere;
						}

						/* 키가 긴 경우 대비(모바일에서 키 폭 자동) */
						@media (max-width: 575.98px) {
							.product-detail-added-spec-item {
								flex-direction: column;
								gap: 6px;
							}

							.product-detail-added-spec-key {
								flex: 0 0 auto;
								max-width: 100%;
								font-size: 13px;
							}

							.product-detail-added-spec-val {
								font-size: 16px;
							}
						}

						/* 아이템 hover로 가독성/클릭감(시각적 강조) */
						.product-detail-added-spec-item:hover {
							background: rgba(0, 0, 0, 0.02);
							border-color: rgba(0, 0, 0, 0.14);
						}

						/* 구분선 느낌의 얇은 상단 라인 */
						.product-detail-added-divider {
							height: 1px;
							background: rgba(0, 0, 0, 0.08);
							margin: 10px 0 14px;
						}
					</style>

					<div class="row">
						<div class="col-12">
							<div class="page-title-box d-sm-flex align-items-center justify-content-between">
								<h4 class="mb-sm-0">팀별업무관리</h4>
								<div class="page-title-right">
									<ol class="breadcrumb m-0">
										<li class="breadcrumb-item"><a href="#">생산팀</a></li>
										<li class="breadcrumb-item active">제작상세</li>
									</ol>
								</div>
							</div>
						</div>
					</div>

					<form th:action="@{/team/updateStatus/{orderId}(orderId=${order.id})}" method="post" class="row">
						<div class="col-lg-4">
							<div class="row g-4 mb-3">
								<div class="col-lg-8">
									<label class="form-label">생산 상태관리</label>
									<select class="form-select" name="status" th:disabled="${!canChangeStatus}">
										<option value="CONFIRMED" th:selected="${order.status.name() == 'CONFIRMED'}"
											th:if="${order.status.name() == 'CONFIRMED'}">
											관리자 승인됨
										</option>
										<option value="PRODUCTION_DONE"
											th:selected="${order.status.name() == 'PRODUCTION_DONE'}"
											th:if="${order.status.name() == 'CONFIRMED' or order.status.name() == 'PRODUCTION_DONE'}"
											th:disabled="${order.status.name() != 'CONFIRMED'}">
											생산 완료
										</option>
										<option th:if="${order.status.name() == 'DELIVERY_DONE'}" selected disabled>
											배송 완료
										</option>
									</select>
								</div>
								<div class="col-lg-4">
									<label class="form-label">액션</label>
									<button type="submit" class="btn btn-success w-100"
										th:disabled="${!canChangeStatus}">상태변경</button>
								</div>
							</div>
						</div>
					</form>

					<div class="row">
						<div class="col-lg-12">
							<div class="card">
								<div class="card-body">
									<div class="row gx-lg-5">
										<div class="col-xl-12">
											<div class="mt-xl-0 mt-5">
												<div class="d-flex">
													<div class="flex-grow-1">
														<div class="hstack gap-3 flex-wrap">
															<div class="text-muted">대리점명 : <span class="text-body fw-medium"
																	th:text="${order.task.requestedBy.company.companyName}">신청자명</span>
															</div>
															<div class="vr"></div>
															<div class="text-muted">신청자 : <span class="text-body fw-medium"
																	th:text="${order.task.requestedBy.name}">신청자명</span>
															</div>
															<div class="vr"></div>
															<div class="text-muted">발주일 : <span class="text-body fw-medium"
																	th:text="${#temporals.format(order.createdAt, 'yyyy-MM-dd')}"></span>
															</div>
															<div class="vr"></div>
															<div class="text-muted">배정일 : <span class="text-body fw-medium"
																	th:text="${#temporals.format(order.updatedAt, 'yyyy-MM-dd')}"></span>
															</div>
															<div class="vr"></div>
															<div class="text-muted">배송일 : <span class="text-body fw-medium"
																	th:text="${#temporals.format(order.preferredDeliveryDate, 'yyyy-MM-dd')}"></span>
															</div>
														</div>
													</div>
												</div>

												<div class="mt-4 text-muted">
													<h5 class="fs-15">고객 남김말 :</h5>
													<p th:text="${order.orderComment}">고객 남김말 영역</p>
												</div>

												<!-- ✅ 여기부터 “상세스펙 및 옵션” 레이아웃 변경 -->
												<div class="product-detail-added-spec-wrap">
													<div class="product-detail-added-spec-title">
														<h5 class="fs-15">상세스펙 및 옵션 :</h5>
														<span class="product-detail-added-spec-badge">중요 옵션</span>
													</div>

													<div class="product-detail-added-divider"></div>

													<div class="product-detail-added-spec-card">
														<div class="product-detail-added-spec-grid">

															<!-- 제품분류 -->
															<div class="product-detail-added-spec-item">
																<div class="product-detail-added-spec-key">제품분류</div>
																<div class="product-detail-added-spec-val"
																	th:text="${order.productCategory.name}">하부장</div>
															</div>

															<!-- 옵션 리스트 -->
															<div class="product-detail-added-spec-item"
																th:each="entry : ${orderItem.parsedOptionMap}">
																<div class="product-detail-added-spec-key"
																	th:text="${entry.key}">옵션키</div>
																<div class="product-detail-added-spec-val"
																	th:text="${entry.value}">옵션값</div>
															</div>

														</div>
													</div>
												</div>
												<!-- ✅ 여기까지 “상세스펙 및 옵션” 레이아웃 변경 끝 -->

												<div class="row mt-4">
													<div class="col-12">
														<label class="form-label">이미지 첨부 파일</label>
													</div>

													<div class="col-12">
														<div class="row g-2">

															<!-- 관리자 업로드 이미지 -->
															<div th:if="${!#lists.isEmpty(order.adminUploadedImages)}"
																class="col-12 mt-3">
																<div class="row g-2">
																	<div class="col-lg-2"
																		th:each="img : ${order.adminUploadedImages}"
																		th:attr="data-id=${img.id}">
																		<div
																			class="border rounded p-2 d-flex flex-column align-items-center text-center position-relative">
																			<img th:src="${img.url}" class="img-fluid mb-2"
																				style="max-height: 120px;" />
																			<span class="text-truncate small"
																				th:text="${img.filename}"
																				style="max-width: 100%;"></span>
																			<a th:href="${img.url}" download class="mt-1">
																				<i class="ri-download-2-line fs-18 text-primary"></i>
																			</a>
																		</div>
																	</div>
																</div>
															</div>

														</div>
													</div>
												</div>

											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>

			<footer th:replace="~{fragments/administration/common :: autoAdminFooter}"></footer>
		</div>
	</div>

	<th:block th:replace="~{fragments/administration/common :: autoAdminSetting}"></th:block>
	<th:block th:replace="~{fragments/administration/common :: authAdminScript}"></th:block>
	<script src="/administration/assets/js/pages/project-overview.init.js"></script>
</body>

</html>
