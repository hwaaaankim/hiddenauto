<!DOCTYPE HTML>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="fragments/front/common :: autoHead"></head>

<body class="theme-light" data-highlight="highlight-red" data-gradient="body-default">

	<th:block th:replace="fragments/front/common :: autoLoader"></th:block>
	<th:block th:replace="fragments/front/common :: autoFooterMenu"></th:block>

	<div id="page" class="container">
		<th:block th:replace="fragments/front/common :: autoHeaderMenu"></th:block>

		<div class="page-content header-clear-medium">

			<!-- ✅ 페이지 전용 CSS -->
			<link rel="stylesheet" href="/front/page/myInfo/myInfo.css">

			<div class="card card-style">
				<div class="content mb-0">
					<h2>계정정보</h2>
					<p class="mb-4">아이디는 변경할 수 없습니다.</p>

					<!-- ✅ 서버 메시지(백엔드 최종 방어) -->
					<div class="myinfo-added-alert myinfo-added-alert-danger"
						th:if="${myInfoError != null}" th:text="${myInfoError}"></div>
					<div class="myinfo-added-alert myinfo-added-alert-success"
						th:if="${myInfoSuccess != null}" th:text="${myInfoSuccess}"></div>

					<form class="myinfo-added-form" method="POST" action="/customer/myInfoUpdate" enctype="multipart/form-data">
						<!-- 사용자 성함 -->
						<div class="input-style input-style-always-active has-borders has-icon">
							<i class="fa fa-user font-12"></i>
							<input type="text" class="form-control" name="name" th:value="${member.name}"
								placeholder="성함" required>
							<label class="color-blue-dark font-13">성함</label>
						</div>

						<!-- 연락처 -->
						<div class="input-style input-style-always-active has-borders has-icon mt-4">
							<i class="fa fa-phone font-12"></i>
							<input type="text" class="form-control" id="myinfo-added-phone"
								   name="phone" th:value="${member.phone}"
								   placeholder="휴대폰 번호(숫자만 입력, 자동 '-' 적용)"
								   required autocomplete="off">
							<label class="color-blue-dark font-13">연락처</label>
							<div class="myinfo-added-help" id="myinfo-added-phone-help"></div>
						</div>

						<!-- 이메일 -->
						<div class="input-style input-style-always-active has-borders has-icon mt-4">
							<i class="fa-solid fa-inbox font-12"></i>
							<input type="email" class="form-control" required name="email" th:value="${member.email}"
								placeholder="이메일">
							<label class="color-blue-dark font-13">이메일</label>
						</div>

						<hr class="my-4" />

						<h2>회사 정보</h2>

						<!-- 회사명 (대표만 수정 가능) -->
						<div class="input-style input-style-always-active has-borders has-icon mt-3">
							<i class="fa-regular fa-building font-12"></i>
							<input type="text" class="form-control" name="companyName" th:value="${company.companyName}"
								placeholder="대리점명" required th:readonly="${!isRepresentative}">
							<label class="color-blue-dark font-13">대리점명</label>
						</div>

						<!-- ✅ 사업자등록번호 (수정 가능) -->
						<div class="input-style input-style-always-active has-borders has-icon mt-3">
							<i class="fa-solid fa-receipt font-12"></i>
							<input type="text"
								   class="form-control"
								   id="myinfo-added-businessNumber"
								   name="businessNumber"
								   th:value="${company.businessNumber}"
								   placeholder="사업자등록번호(숫자만 입력, 자동 '-' 적용)"
								   required
								   autocomplete="off"
								   th:readonly="${!isRepresentative}">
							<label class="color-blue-dark font-13">사업자등록번호</label>
							<div class="myinfo-added-help" id="myinfo-added-businessNumber-help"></div>
						</div>

						<!-- 포인트 -->
						<div class="input-style input-style-always-active has-borders has-icon mt-3">
							<i class="fa-regular fa-building font-12"></i>
							<input type="text" class="form-control" th:value="${company.point}" readonly>
							<label class="color-blue-dark font-13">포인트</label>
						</div>

						<!-- 주소 검색 영역 (대표만 수정 가능) -->
						<div class="input-style input-style-always-active has-borders has-icon mt-3">
							<i class="fa-regular fa-address-book"></i>
							<input type="text" class="form-control" id="searchAddress" name="roadAddress" required
								placeholder="주소를 검색 해 주세요." autocomplete="off" th:value="${company.roadAddress}"
								th:readonly="${!isRepresentative}">
							<button type="button" onclick="execDaumPostcode()"
								th:disabled="${!isRepresentative}">주소검색</button>
							<label for="searchAddress" class="color-blue-dark font-10 mt-1">주소</label>
						</div>

						<!-- 상세주소 + hidden 행정구역 (대표만 수정 가능) -->
						<div class="input-style input-style-always-active has-borders has-icon mt-3">
							<i class="fa-regular fa-address-book"></i>
							<input type="text" class="form-control" id="detailAddress" name="detailAddress" required
								placeholder="상세 주소를 입력 해 주세요." autocomplete="off" th:value="${company.detailAddress}"
								th:readonly="${!isRepresentative}">
							<label for="detailAddress" class="color-blue-dark font-10 mt-1">상세주소</label>

							<input type="hidden" name="doName" id="doName" th:value="${company.doName}" required>
							<input type="hidden" name="siName" id="siName" th:value="${company.siName}">
							<input type="hidden" name="guName" id="guName" th:value="${company.guName}">
							<input type="hidden" name="zipCode" id="zipCode" required th:value="${company.zipCode}">
						</div>

						<hr class="my-4" />
						<h2>추가 배송지</h2>
						<p class="mb-3">회사에 등록된 추가 배송지를 관리할 수 있습니다.</p>

						<div class="mb-3">
							<a href="javascript:void(0);" id="companyAddDeliveryBtn"
								class="btn btn-full bg-blue-dark btn-m text-uppercase rounded-sm shadow-l font-900">
								+ 배송지 추가
							</a>
						</div>

						<div id="companyDeliveryList" class="mb-3"></div>

						<input type="hidden" id="companyDeliveryAddressesJson" name="companyDeliveryAddressesJson"
							value="" />

						<!-- =========================
						     ✅ 사업자등록증(대표만)
						     ========================= -->
						<hr class="my-4" />
				     	<h2>사업자등록증</h2>
				     	<p class="mb-3">사업자등록증은 필수 항목입니다.</p>

						<div class="pb-1" th:if="${isRepresentative}">
							<label class="signUpImageBtn">
								<input type="file" id="myinfo-added-license-input"
									   name="businessLicenseFile"
									   class="signUpImageInput"
									   accept="image/*">
								<i class="fa-regular fa-file"></i> 사업자등록증 업로드
							</label>

							<!-- ✅ 프리뷰 영역(기존/신규 공통) -->
							<div class="myinfo-added-license-wrap">
								<!-- 기존 이미지가 있으면 표시 -->
								<div id="myinfo-added-license-existing"
									 class="myinfo-added-license-box"
									 th:classappend="${company.businessLicenseUrl == null} ? ' d-none' : ''">
									<a class="myinfo-added-license-link" th:href="@{${company.businessLicenseUrl}}" target="_blank">
										<img id="myinfo-added-license-existing-img"
											 th:src="@{${company.businessLicenseUrl}}"
											 alt="사업자등록증"
											 class="myinfo-added-license-img">
									</a>
									<button type="button"
											class="myinfo-added-license-x"
											id="myinfo-added-license-existing-remove"
											aria-label="삭제">×</button>
								</div>

								<!-- 신규 선택 프리뷰(기본 숨김) -->
								<div id="myinfo-added-license-new" class="myinfo-added-license-box d-none">
									<img id="myinfo-added-license-new-img" alt="사업자등록증(신규)" class="myinfo-added-license-img">
									<button type="button"
											class="myinfo-added-license-x"
											id="myinfo-added-license-new-remove"
											aria-label="삭제">×</button>
								</div>
							</div>

							<!-- 필수 상태 안내 -->
							<div class="myinfo-added-help" id="myinfo-added-license-help"></div>

							<input type="hidden" id="removeBusinessLicense" name="removeBusinessLicense" value="false" />
						</div>

						<!-- 수정 버튼 -->
						<div class="mt-4 mb-2">
							<button type="submit"
									id="myinfo-added-submit"
									class="btn btn-full w-100 bg-green-dark btn-m text-uppercase rounded-sm shadow-l font-900">
								변경사항 저장
							</button>
						</div>
					</form>

				</div>
			</div>

			<div class="card card-style" th:if="${isRepresentative}">
				<div class="content mb-0">
					<h2>대리점코드</h2>
					<p class="mb-4">직원 등록시 대리점 코드 입력이 필수입니다.</p>
					<div class="input-style input-style-always-active has-borders has-icon">
						<i class="fa-solid fa-key font-12"></i>
						<input type="text" class="form-control" placeholder="대리점코드" readonly
							th:value="${company.registrationKey}">
						<label class="color-blue-dark font-13">대리점코드</label>
					</div>
					<a href="javascript:void(0);" onclick="generateKey()"
						class="btn btn-full bg-green-dark btn-m text-uppercase rounded-sm shadow-l mb-3 mt-4 font-900">
						코드생성
					</a>
				</div>
			</div>

			<div class="card card-style">
				<div class="content mb-0">
					<h2 class="mb-0">비밀번호</h2>
					<p class="mb-4">비밀번호 변경을 진행할 수 있습니다.</p>
					<form method="POST" id="passwordForm" action="/customer/changePassword">
						<div class="input-style input-style-always-active has-borders no-icon">
							<input type="password" name="newPassword" class="form-control" required
								placeholder="새로운 비밀번호 입력">
							<label class="color-blue-dark font-12">새로운 비밀번호</label>
							<em>(required)</em>
						</div>
						<button type="submit"
							class="btn btn-full w-100 bg-green-dark btn-m text-uppercase rounded-sm shadow-l mb-3 mt-4 font-900">
							비밀번호 변경
						</button>
					</form>
				</div>
			</div>

		</div>

		<th:block th:replace="fragments/front/common :: autoBottomMenu"></th:block>
	</div>

	<th:block th:replace="fragments/front/common :: autoSideBar"></th:block>
	<th:block th:replace="fragments/front/common :: autoScript"></th:block>

	<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

	<script th:inline="javascript">
		window.__COMPANY_DELIVERY_ADDRESSES__ = /*[[${deliveryAddresses}]]*/[];
		window.__MYINFO_EXISTING_LICENSE_URL__ = /*[[${company.businessLicenseUrl}]]*/ null;
		window.__MYINFO_IS_REPRESENTATIVE__ = /*[[${isRepresentative}]]*/ false;
	</script>

	<!-- ✅ 외부 JS(요청 경로) -->
	<script src="/front/page/myInfo/myInfo.js"></script>

	<!-- =========================
	     ✅ 추가 배송지 상세주소 입력 모달(기존 유지)
	     ========================= -->
	<div class="modal fade" id="companyDeliveryDetailModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content rounded-lg">
				<div class="modal-header">
					<h5 class="modal-title">추가 배송지 상세주소</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>

				<div class="modal-body">
					<div class="mb-3">
						<div class="font-600 mb-1">선택한 주소</div>
						<div id="companyDeliverySelectedAddress" class="p-2 border rounded-sm"></div>
					</div>

					<div class="mb-3">
						<label for="companyDeliveryDetailInput" class="form-label font-600">상세 주소</label>
						<input type="text" class="form-control" id="companyDeliveryDetailInput"
							placeholder="상세 주소를 입력해 주세요. (예: 101동 1203호)">
						<div class="form-text">상세 주소가 없으면 비워도 됩니다.</div>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">취소</button>
					<button type="button" class="btn btn-primary" id="companyDeliveryDetailSaveBtn">저장</button>
				</div>
			</div>
		</div>
	</div>

</body>
</html>
